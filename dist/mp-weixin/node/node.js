"use strict";function t(t){return o(t)||i(t)||e(t)||r()}function r(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function e(t,r){if(t){if("string"==typeof t)return a(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?a(t,r):void 0}}function i(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function o(t){if(Array.isArray(t))return a(t)}function a(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,i=new Array(r);e<r;e++)i[e]=t[e];return i}function s(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}Component({data:{ctrl:{},isiOS:wx.getSystemInfoSync().system.includes("iOS")},properties:{childs:Array,opts:Array},options:{addGlobalClass:!0},attached:function(){this.triggerEvent("add",this,{bubbles:!0,composed:!0})},methods:{noop:function(){},getNode:function(t){try{for(var r=t.split("_"),e=this.data.childs[r[0]],i=1;i<r.length;i++)e=e.children[r[i]];return e}catch(t){return{text:"",attrs:{},children:[]}}},play:function(t){if(this.root.triggerEvent("play"),this.root.data.pauseVideo){for(var r=!1,e=t.target.id,i=this.root._videos.length;i--;)this.root._videos[i].id===e?r=!0:this.root._videos[i].pause();if(!r){var o=wx.createVideoContext(e,this);o.id=e,this.root.playbackRate&&o.playbackRate(this.root.playbackRate),this.root._videos.push(o)}}},imgTap:function(t){var r=this.getNode(t.target.dataset.i);if(r.a)return this.linkTap(r.a);if(!r.attrs.ignore&&(this.root.triggerEvent("imgtap",r.attrs),this.root.data.previewImg)){var e=this.root.imgList[r.i];wx.previewImage({showmenu:this.root.data.showImgMenu,current:e,urls:this.root.imgList})}},imgLoad:function(t){var r,e=t.target.dataset.i,i=this.getNode(e);i.w?(this.data.opts[1]&&!this.data.ctrl[e]||-1===this.data.ctrl[e])&&(r=1):r=t.detail.width,r&&this.setData(s({},"ctrl."+e,r)),this.checkReady()},checkReady:function(){var t=this;this.root.data.lazyLoad||(this.root.imgList._unloadimgs-=1,this.root.imgList._unloadimgs||setTimeout(function(){t.root.getRect().then(function(r){t.root.triggerEvent("ready",r)}).catch(function(){t.root.triggerEvent("ready",{})})},350))},linkTap:function(t){var r=t.currentTarget?this.getNode(t.currentTarget.dataset.i):{},e=r.attrs||t,i=e.href;this.root.triggerEvent("linktap",Object.assign({innerText:this.root.getText(r.children||[])},e)),i&&("#"===i[0]?this.root.navigateTo(i.substring(1)).catch(function(){}):i.split("?")[0].includes("://")?this.root.data.copyLink&&wx.setClipboardData({data:i,success:function(){return wx.showToast({title:"链接已复制"})}}):wx.navigateTo({url:i,fail:function(){wx.switchTab({url:i,fail:function(){}})}}))},imgError:function(r){var e=r.currentTarget.dataset.i,i=e.split("_"),o=this.data.childs;i.forEach(function(t){o=Array.isArray(o)?o[t]:o.children[t]});var a=o.attrs.src;a&&(o.attrs.src=-1===a.indexOf("https://images.weserv.nl/?url=")?"https://images.weserv.nl/?url="+a:a,this.setData({childs:t(this.data.childs)}))},mediaError:function(t){var r=t.target.dataset.i,e=this.getNode(r);if("video"===e.name||"audio"===e.name){var i=(this.data.ctrl[r]||0)+1;if(i>e.src.length&&(i=0),i<e.src.length)return this.setData(s({},"ctrl."+r,i))}else"img"===e.name&&(this.data.opts[2]&&this.setData(s({},"ctrl."+r,-1)),this.checkReady());this.root&&this.root.triggerEvent("error",{source:e.name,attrs:e.attrs,errMsg:t.detail.errMsg})}}});